Introduction

The Coronavirus Disease 2019 (COVID- 19) has infected more than 113 million people worldwide (as of February 28th, 2021 1 ) and caused more than 2.52 million deaths. Although many cases present only mild symptoms, some of them evolve into serious illnesses that require intensive medical treatment or lead to death [7] .First two authors contributed equally to this work. 1 https://coronavirus.jhu.edu/map.htmlChest computed tomography (CT) has played an essential diagnostic role in the assessment of patients with COVID-19 by showing specific image patterns such as ground-glass opacity (GGO), crazy paving, and consolidation [22] . Several studies have proposed to automatically analyze COVID-19 infection on chest images with deep learning [5, 26, 21, 11, 12] . However, it is still challenging to automatically identify and quantify image findings associated with COVID-19 due to the subtle anatomical boundaries, pleural-based location, and variations in size, density, location, and texture [14, 19, 27] . Moreover, it is vital to develop an effective method to reliably assess the progression of COVID-19 and response to therapy [6, 23] . Given the availability of multiple therapy options and to understand anatomical changes during the healing process, a longitudinal evaluation of CT images can be beneficial [6, 9] .Only a few studies have devoted to developing a deep learning-based approach to assess the progression and response to therapy from longitudinal CT scans [25, 17] . Zhang et al. propose a static segmentation model to classify the patients into mild and severe patients based on the features extracted from longitudinal CT scans [25] . Pu et al. propose a framework consisting on the following steps (1) segment the lung boundary and vessels, (2) register the boundary between serial scans using deformable registration, (3) identify regions with morphological changes due to the disease, and (4) assess disease progression [17] . The registered longitudinal CT scans are used to generate a heatmap visualizing the difference in diseased vs. healthy areas between scans. Yet, the identification of affected regions is performed in a static way, i.e., the information between serial scans is not taken into account. Besides, they do not differentiate image features of consolidation and GGO, even though these pathologies provide different information of infection in COVID-19 cases [28] .In this paper, we propose a novel framework to identify infection at a finegrained level (identification of healthy lung, consolidation, GGO, and pleural effusion) by leveraging spatio-temporal cues between longitudinal scans and visualize the progression of COVID-19. In particular, we devise a longitudinal segmentation network that utilizes the reference scan information to improve the performance of disease segmentation. Even though longitudinal scans share structural information, differences exist due to the progression of the disease. We investigate and propose ways to use this information during the segmentation based on a dataset collected during the first COVID-19 wave of our institution. The following is the summary of the main contributions.-To the best of our knowledge, this is the first study to explore the longitudinal segmentation of CTs of COVID-19 patients. By designing a deep network to use the information provided in the reference scan, we show that the performance of segmentation can be improved compared to the static segmentation model. Our method shows promising results with limited data. -We propose a framework to analyze the progression of COVID-19 infection over time, which is crucial for the course of the disease and the patient's recovery. -We present comprehensive analysis and ablation studies to verify our longitudinal analysis framework's design choice.

Methodology

This section describes our approaches for incorporating spatio-temporal features into the framework of segmentation and progression quantification. Figure 1 shows overall framework which consists of the following three components: 1) longitudinal registration, 2) longitudinal segmentation, and 3) progression analysis. The analyses are performed based on two different time point scans.

Longitudinal Registration

Due to the nature of chest CT scans, the initial volumes of data between different time points are highly misaligned. Aspects like patient positioning, variations of the imaging parameters or devices, different phases in the breathing cycle, and the disease progression are the main reasons. This misalignment cannot be described as a linear transformation composed of translation and rotation between the time points of data and can only be expressed through non-linear transformations. The misalignment can make the network incapable of using the longitudinal information present between different time points of data. As a solution for this problem, we utilize a deformable registration algorithm [16] where a BSpline Transform is defined using a sparse set of grid points overlaid onto the fixed domain of the image domain to deform it. Using this algorithm we register the reference scan lung mask M 0 to the follow up scan lung mask M 1 and this transform function is defined by R M0→M1 (·). Based on this function, the transformations are applied to the respective CT-scans as X reg 0 = R M0→M1 (X 0 ). Using the lung masks, we avoid registration errors due to the pathological changes in the lung parenchyma while compensating for positioning, breathing phase, and acquisition-related differences.

Longitudinal Segmentation

Due to the challenge of training a 3D model with a limited number of training data, 2.5D approaches [2, 24, 18, 4] have shown state-of-the-art results on various medical segmentation problems. For the 3D approach, it is challenging to directly process a full 3D volume by using current GPU memory limitations [18] , which forces people to operate on 3D patches [20, 8] . However, patch-wise training limits the overall spatial context for accurate semantic segmentation.In this study, we adopt the 2.5D approach of [4] with a fully convolutional (FC) DenseNet [10] as a baseline 2D segmentation model. The FC DenseNet consists of a downsampling path (Encoder) with 5 Transitions Down blocks, each with 4 layers and an upsampling path (Decoder) with 5 Transitions Up blocks, each with 4 layers. The model is trained for all three views (coronal, sagittal, and axial view). At test time, for each given voxel, the segmentation is conducted on all three orthogonal views. Afterward, the predicted probability of a given voxel is averaged among views to assign a final predicted probability.We extend the aforementioned 2.5D segmentation to deal with longitudinal information by modifying its architecture. To capture subtle spatio-temporal cues, we concatenate two registered scans from two different time-points as input for the longitudinal segmentation network: [X reg 0 , X 1 ] for segmenting pathologies on X 1 or [X 1 , X reg 0 ] for X 0 . This enables the segmentation network to capture temporal changes as shown in Figure 1 . For subjects who have more than two scans, we select consecutive scans for the segmentation in each step.

Progression Analysis

To monitor the progression of the COVID-19 infection and the response to therapy, we extract the segmented pathologies from consecutive longitudinal CT scans and quantify the volume differences between them. Our approach is capable of quantifying all combinations of changes between different pathologies and healthy lung parenchyma. In this work's scope, we define two classes as consolidation and non-consolidation since consolidation has shown to be a robust biomarker for COVID-19 [15] . The progression of consolidation is computed by subtracting two registered longitudinal CT-scans. The resulting residual voxel values could be either positive or negative. Positive voxels indicate that a healthy, GGO or pleural effusion region progresses to consolidation (Progression), and negative voxels suggest that an area recovers from the severe infection of consolidation (Recovery).

Training with Progression Information

For the optimization of our model, we define an overall loss function combining a segmentation loss L seg and a progression loss L prog . Note that as shown in Fig. 1 , the outputs of our model consist of the segmentation masks for reference (t=0) and follow-up (t=1) scans and the subtracted volume between reference and follow-up scans for presenting progression of the COVID-19 infection. The overall loss is defined as: L = L seg + L prog .The segmentation loss is defined aswhere L M SE denotes a mean squared error loss [24, 4] . In our evaluation, this metric yielded better results in comparison to the dice score. Y 0 andŶ 0 denote a ground truth pathology segmentation map and a predicted segmentation mask for t=0 scan, respectively. Y 1 andŶ 1 denote a ground truth pathology segmentation map and a predicted segmentation mask for t=1 scan.The progression loss is defined aswhere Y con denotes a ground truth consolidation map andŶ con denotes a predicted consolidation map. In those binary maps, consolidation is mapped to 1 and non-consolidation to 0. As explained above, the progression map is calculated by Y con 1 − Y con 0 . Note that, the progression loss does not minimize the distance between the two segmentations. Instead it explicitly uses the structural changes of pathologies through times as cues for modeling the optimization. In other words, if there are large changes over time, the progression loss encourages the model to predict those large changes also in the segmentation.

Dataset

To our knowledge there is no publicly available longitudinal CT dataset for COVID-19. Accordingly, to evaluate the proposed method, we used an in-house clinical dataset which consists of longitudinal low-dose CT-scans from 38 patients (64±18 years old, 16 females, 22 males) with positive PCR from the first COVID-19 wave (March-June 2020). 28 patients had two scans and 10 had three. The CTs were separated 17±10 days (1-43 days) and were taken at admission and during the hospital stay (33±21 days, 0-71 days). 8 patients of the 38 died; 30 recovered from COVID-19, 20 of them needing intensive care. All scans were performed inhouse using two different CT devices (IQon Spectral CT and iCT 256, Philips, Hamburg, Germany) with the same parameters (X-ray current 140-210 mA, voltage 120 kV peak, slice thickness 0.9mm, no contrast media) and covered the complete lung. The data was collected retrospectively with the approval of the institutional review board of our institution (ethics approval 111/20 S-KH).The dataset was annotated at a voxel-level by a single expert radiologist (5 years experience), generating lung masks (lung parenchyma vs. other tissues) and pathology masks including four classes: healthy lung (HL), GGO, consolidation (CONS), and pleural effusion (PLEFF). For segmentation, the radiologist used the software ImFusion Labels (ImFusion, Munich, Germany).The dataset was split into a training set of 16 patients (37 volumes) and an independent test set of 22 patients (49 volumes). From the training set, 12 patient scans are used for model training and 4 patient scans are used for validation. The model is finally evaluated on the unseen test set. 

Implementation Details

The raw CT volumes highly vary in intensity range, size, and alignment. Therefore, we perform the following pre-processing steps on the raw volumes to enable effective use of the longitudinal data:Cropping. Since different body regions can be presented between time points and patients, we crop the volumes to the lung regions, using the manuallyannotated lung masks. Clipping and Normalization. To alleviate different intensity ranges among CT-scans, intensity values outside the range (−1024, 600) are clipped and then min-max normalization is performed on each volume.Resizing. After Cropping, resulting volumes vary in size in all three dimensions, ranging from 100 pixels to 580 pixels. Therefore all volumes are resized to a fixed size of 300×300×300 with 300 being the median among the cropped-volume sizes. Slicing and Removing Empty Slices. Finally, the volumes are sliced in each of the three dimensions to 300 slices, generating sagittal, coronal, and axial views of the lung. Slices that have a voxel-value variation smaller than 0.001% between their maximum and the minimum value are considered empty and are removed. Model Training. For training, Adam optimizer [13] with a learning rate of 0.0001 and a decay rate of 0.1 for every 50 steps was used. The model was trained over 100 epochs with early stopping if no decrease in the validation loss was computed for 5 epochs. Our method was implemented in PyTorch 1.4 and our models were trained on an NVIDIA Titan V 12GB GPU using Polyaxon 2 . The source code is publicly available 3 . Our longitudinal model had 1.3752M parameters in comparison to its static counterpart 1.3748M.

Results and Discussion

Effectiveness of Longitudinal Segmentation First, we conduct comparative experiments to verify the effectiveness of our longitudinal segmentation method. Table 2 . Ablation study to investigate the effectiveness of the registration and using temporal information in our longitudinal segmentation model. Dice similarity coefficient is measured on the independent test set. In Table 1 , we compare our method with a static network [24] based on FC-DenseNet [10] and with a longitudinal network without progression loss. This simpler longitudinal network has the same architecture as our proposed one, i.e., it concatenates longitudinal CT scans as an input for the segmentation model, but it is trained using only the segmentation loss. As shown in Table 1 , both longitudinal networks achieved a higher Dice Similarity Coefficient (DSC) than the static network. The difference was statistically significant for all classes (p<0.05 by paired t-test [1] ). This implies that using longitudinal information from the reference CT scan is informative to segment pathology on the target CT scan. In our longitudinal network with progression loss, the DSC was further improved for HL, CONS, and GGO. But for PLEFF, the performance slightly decreased. This can be attributed to the fact that the progression loss encourages the model to focus on CONS rather than on PLEFF. Additionally, PLEFF is a challenging, under-represented class in our dataset (only 2.17% voxels).

Method

Effect of Longitudinal Registration. To showcase the importance of registration among the longitudinal scans, we report results with and without deformable registration. As seen in Table 2 the performance after registration substantially improves across the board with the increase ranging from 0.07 to 0.10.Importance of Temporal Information in Longitudinal Network. In this experiment, we highlight the importance of the longitudinal scans for the performance of the model. Specifically, we concatenate two duplicates of the reference scan instead of the reference and follow-up scan as input to our model ('static input'). As shown in Table 2 , the longitudinal input (proposed method) outperforms the static input for all classes.Progression Analysis. Finally, we evaluate our method for progression analysis by comparing with a static network [17] , a longitudinal network with multiview approach [3] and our model trained without the progression loss. As shown in Table 3 , our longitudinal architecture has a 3.4% increase compared to the static network. The proposed model with the progression loss has a 4.8% increase with respect to static network. Note that the model using the progression loss significantly outperformed the static network [17] and the longitudinal network with multi-view approach [3] (p<0.05). Moreover, the progression loss had Fig. 2 . Qualitative results of our method for 3 patients from different views. For the segmentation maps, blue, green, red and yellow denote healthy lung, consolidation, ground-glass opacity, and pleural effusion, respectively. For the progression map, red denotes Progression and the green Recovery. statistically significant improvement for the recovery and average progression prediction compared to the longitudinal model without the progression loss. Figure 2 showcases qualitative results of the segmentation and progression analysis of our method for all 3 different views. As shown in Figure 2 , our method successfully provides segmentation and progression maps for both reference and follow-up scans across views and patients. Even the under-represented class of PLEFF is successfully segmented. Regarding the progression, the fine-grained regions of recovered and progressed consolidation are also correctly identified.

Conclusion

In this work, we proposed a new longitudinal segmentation and progression analysis model for assessing COVID-19 disease over time. Comprehensive experiments were conducted to verify the effectiveness of the longitudinal model. By designing the model to exploit the reference CT scan, our method can achieve higher progression analysis performance compared to the baseline methods.What makes our approach especially interesting is the ability to monitor the development of the infection and healing process in COVID-19, and possibly in other lung diseases. It can be used to compute the differences in disease progression of different patient subgroups, such as different COVID-19 variants under the same therapy. Moreover, it could serve as a quantitative measure to evaluate different therapy approaches. We will further investigate and improve the clinical usability of the method for a larger patient cohort.

